# FastDEM Configuration
mapping:
  type: "kalman_filter"      # kalman_filter | p2_quantile
  kalman:
    min_variance: 0.0001     # [m²] prevents over-confidence
    max_variance: 0.01       # [m²] caps uncertainty
    process_noise: 0.0       # [m²] maintains filter receptivity (0 = static terrain)
  p2:
    dn0: 0.01                # 1st percentile (soft min)
    dn1: 0.16                # 16th percentile (≈ mean - 1σ)
    dn2: 0.50                # 50th percentile (median)
    dn3: 0.84                # 84th percentile (≈ mean + 1σ)
    dn4: 0.99                # 99th percentile (soft max)
    elevation_marker: 3      # which marker to use as elevation (0-4)
    max_sample_count: 0      # fading memory (0 = disabled, 50-200 for dynamic scenes)

# Sensor uncertainty model (Σ_sensor → σ_z²)
sensor_model:
  type: "lidar"              # constant | lidar | rgbd
  range_noise: 0.02          # [m] σ_r (LiDAR)
  angular_noise: 0.001       # [rad] σ_θ (LiDAR)
  normal_a: 0.001            # [m] base depth noise (RGB-D)
  normal_b: 0.002            # [m⁻¹] quadratic coefficient (RGB-D)
  normal_c: 0.4              # [m] optimal depth (RGB-D)
  lateral_factor: 0.001      # lateral noise factor (RGB-D)
  constant_uncertainty: 0.03 # [m] σ (constant model)

# Post-processing
raycasting:
  enabled: true
  height_conflict_threshold: 0.05  # [m] min height diff for conflict
  log_odds_observed: 0.4     # evidence for cell being present (measured this frame)
  log_odds_ghost: 0.2        # evidence for cell being empty (ray passes below)
  log_odds_max: 2.0          # upper clamp (prevents over-confidence)
  clear_threshold: -1.0      # clear cell when logodds falls below this

uncertainty_fusion:
  enabled: true
  search_radius: 0.15       # [m] neighbor search radius
  spatial_sigma: 0.05        # [m] Gaussian distance decay
  quantile_lower: 0.01       # 1st percentile
  quantile_upper: 0.99       # 99th percentile
  min_valid_neighbors: 3
