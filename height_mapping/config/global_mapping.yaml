# Height Mapping Configuration - Global Mapping (Fixed Origin)
# Uses ppl (Pipeline Library) format

# Mapper settings
mapper:
  map:
    width: 200.0          # Map width in meters
    height: 200.0         # Map height in meters
    resolution: 0.1       # Map resolution in meters per cell
    frame_id: "map"       # Map coordinate frame

# Pipeline configuration
# No MoveOrigin stage = map-centric (fixed origin)
pipeline:
  enable_profiling: true  # Enable pipeline profiling
  profile_interval: 100   # Print report every N runs
  stages:
    - VoxelFilter
    - PassthroughFilter
    - Raycasting
    - HeightEstimation

# Algorithm configurations
algorithms:
  VoxelFilter:
    type: VoxelFilter
    voxel_size: 0.05          # 5cm voxels
    reduction_method: "centroid"  # centroid, random, first, closest, center

  PassthroughFilter:
    type: PassthroughFilter
    range_min: 0.5    # Remove robot body hits
    range_max: 10.0
    z_min: -0.1
    z_max: 2.0

  Raycasting:
    type: Raycasting
    correction_threshold: 0.02  # 2cm ghost clearing threshold
    min_ray_distance: 0.5       # Skip rays shorter than 0.5m
    enable_correction: true
    # Persistence (obstacle durability) - tuned for 10Hz LiDAR
    persistence_max_count: 30.0    # ~3 sec durability at 10Hz
    persistence_step_add: 3.0      # Hit: fast registration
    persistence_step_sub: 1.0      # Miss: slow removal

  HeightEstimation:
    type: HeightEstimation
    estimator_type: "incremental_mean"  # incremental_mean, kalman_filter, moving_average
    # Kalman filter parameters
    kalman_process_noise: 0.01
    kalman_measurement_noise: 0.05
    kalman_initial_variance: 1000.0
    # Moving average parameters
    moving_average_alpha: 0.3

  Inpainting:
    enabled: false              # Enable inpainting
    max_iterations: 3           # Usually 1-3 sufficient for small holes
    min_valid_neighbors: 2      # Minimum neighbors to interpolate (1-8)
